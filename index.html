<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#0A0A0A">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SGD/JPY">
  
  <title>Singapore Dollar to Japanese Yen Converter | SGD to JPY Live Rate | Free Calculator</title>
  <meta name="description" content="Convert Singapore Dollar to Japanese Yen instantly. Free SGD to JPY calculator with live exchange rates. Works offline.">
  <meta name="keywords" content="singapore dollar to yen, sgd to jpy, singapore yen converter, singapore yen calculator, sgd jpy rate, currency converter">
  <link rel="canonical" href="https://sgd-jpy.vercel.app/">
  
  <meta property="og:title" content="Singapore Dollar to Japanese Yen Converter | Live SGD/JPY Rate">
  <meta property="og:description" content="Convert Singapore Dollar to Japanese Yen instantly with live rates. Free, fast, no signup required.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://sgd-jpy.vercel.app/">
  
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
  <link rel="apple-touch-icon" href="/icon-192.png">
  
  <link rel="preconnect" href="https://api.exchangerate-api.com">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9202142689270811" crossorigin="anonymous"></script>

  <script>
    var isAndroidAppReferrer = (document.referrer || '').startsWith('android-app://');
    var isLikelyTWA = isAndroidAppReferrer;
    window.__ADS_ENABLED__ = !isLikelyTWA;

    function pushAllAds() {
      try {
        var ins = document.querySelectorAll('ins.adsbygoogle');
        for (var i = 0; i < ins.length; i++) {
          if (ins[i].dataset.pushed === '1') continue;
          ins[i].dataset.pushed = '1';
          (adsbygoogle = window.adsbygoogle || []).push({});
        }
      } catch (e) {}
      requestAnimationFrame(revealIfFilled);
      setTimeout(revealIfFilled, 800);
      setTimeout(revealIfFilled, 2000);
      setTimeout(revealIfFilled, 6000);
    }

    function revealIfFilled() {
      try {
        var slots = [
          {wrap: document.getElementById('adTop'), ins: document.querySelector('#adTop ins.adsbygoogle')},
          {wrap: document.getElementById('adMid'), ins: document.querySelector('#adMid ins.adsbygoogle')},
          {wrap: document.getElementById('adBottom'), ins: document.querySelector('#adBottom ins.adsbygoogle')}
        ];
        for (var i = 0; i < slots.length; i++) {
          var w = slots[i].wrap, el = slots[i].ins;
          if (!w || !el) continue;
          if (el.getAttribute('data-ad-status') === 'filled' || el.querySelector('iframe')) {
            w.classList.add('show');
          }
        }
      } catch(e) {}
    }

    if (window.__ADS_ENABLED__) {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function () {
          requestAnimationFrame(pushAllAds);
          setTimeout(pushAllAds, 300);
        });
      } else {
        requestAnimationFrame(pushAllAds);
        setTimeout(pushAllAds, 300);
      }
    }
  </script>

  <style>
    :root {
      --bg: #0A0A0A; --surface: #1A1A1E; --surface-active: #222226; --border: #2A2A2E;
      --text: #FAFAFA; --text-dim: #888892; --text-muted: #555560;
      --sgd-red: #ED2939; --sgd-glow: rgba(237, 41, 57, 0.12); --sgd-border: rgba(237, 41, 57, 0.30);
      --jpy-red: #BC002D; --jpy-glow: rgba(188, 0, 45, 0.12); --jpy-border: rgba(188, 0, 45, 0.30);
      --green: #00C853; --green-dim: rgba(0, 200, 83, 0.12);
      --red: #FF3B30; --red-dim: rgba(255, 59, 48, 0.12);
      --premium-red: #FF4757;
      --safe-top: env(safe-area-inset-top, 0px); --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; overflow-x: hidden; overflow-y: auto; background: var(--bg); color: var(--text); font-family: 'DM Sans', -apple-system, sans-serif; -webkit-font-smoothing: antialiased; }
    .app { display: flex; flex-direction: column; height: 100%; max-width: 480px; margin: 0 auto; padding: max(8px, var(--safe-top)) 16px max(8px, var(--safe-bottom)); }
    .premium-banner { display: flex; align-items: center; justify-content: center; gap: 6px; padding: 10px; cursor: pointer; flex-shrink: 0; }
    .premium-banner-icon { font-size: 18px; }
    .premium-banner-text { color: var(--premium-red); font-size: 14px; font-weight: 700; }
    .premium-banner.hidden { display: none; }
    .ad-slot { margin: 4px 0; align-items: center; justify-content: center; border-radius: 10px; flex-shrink: 0; overflow: hidden; }
    #adTop, #adMid, #adBottom { display: none; }
    .ad-slot.show { display: flex; }
    .ad-slot ins.adsbygoogle[data-ad-status="filled"] { min-height: 50px; }
    .rate-bar { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 0; }
    .rate-label { color: var(--text-dim); font-size: 12px; }
    .rate-value { font-size: 14px; font-weight: 700; font-family: 'Space Mono', monospace; transition: color 0.3s; }
    .rate-value.up { color: var(--green); } .rate-value.down { color: var(--red); }
    .change-badge { font-size: 11px; font-weight: 600; padding: 2px 6px; border-radius: 6px; }
    .change-badge.positive { color: var(--green); background: var(--green-dim); }
    .change-badge.negative { color: var(--red); background: var(--red-dim); }
    .fields-wrapper { position: relative; }
    .field { display: flex; align-items: center; justify-content: space-between; padding: 18px 16px; border-radius: 16px; border: 2px solid var(--border); background: var(--surface); cursor: pointer; transition: all 0.2s; -webkit-user-select: none; user-select: none; }
    .field:active { transform: scale(0.98); }
    .field.active-sgd { border-color: var(--sgd-border); background: var(--sgd-glow); }
    .field.active-jpy { border-color: var(--jpy-border); background: var(--jpy-glow); }
    .field + .field { margin-top: 10px; }
    .field-left { display: flex; align-items: center; }
    .currency-icon { width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; flex-shrink: 0; }
    .currency-label { margin-left: 10px; font-size: 16px; font-weight: 600; }
    .field-value { font-size: 28px; font-weight: 600; font-family: 'Space Mono', monospace; text-align: right; flex: 1; margin-left: 12px; overflow: hidden; white-space: nowrap; }
    .field-value.dim { color: var(--text-dim); } .field-value.small { font-size: 20px; }
    .swap-btn { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); z-index: 10; width: 44px; height: 44px; border-radius: 12px; background: var(--surface); border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.4); font-size: 20px; font-weight: 700; color: var(--text); -webkit-user-select: none; user-select: none; }
    .swap-btn:active { transform: translateY(-50%) scale(0.9); }
    .numpad { flex: 1; display: flex; flex-direction: column; gap: 12px; padding: 12px 0; justify-content: center; align-items: center; min-height: 0; }
    .numpad-row { display: flex; gap: 16px; justify-content: center; }
    .num-key { width: 72px; height: 72px; border-radius: 50%; background: #2C2C2E; border: none; color: var(--text); font-size: 26px; font-weight: 500; font-family: 'DM Sans', sans-serif; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.1s, transform 0.1s; -webkit-user-select: none; user-select: none; }
    .num-key:active { background: #3A3A3C; transform: scale(0.92); }
    .num-key.clear { background: var(--red); color: #fff; font-weight: 700; }
    .num-key.clear:active { background: #E0342A; }
    .footer { text-align: center; padding: 4px 0 2px; flex-shrink: 0; }
    .footer-row { display: flex; align-items: center; justify-content: center; gap: 4px; }
    .footer-text { color: var(--text-muted); font-size: 12px; }
    .footer-premium { color: var(--premium-red); font-size: 11px; cursor: pointer; margin-top: 2px; }
    .footer-premium.hidden { display: none; }
    .seo-content { position: absolute; left: -9999px; width: 1px; height: 1px; overflow: hidden; }
    .premium-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 1000; background: var(--bg); display: flex; flex-direction: column; align-items: center; padding: 40px 24px 32px; overflow-y: auto; }
    .premium-overlay.hidden { display: none; }
    .premium-close { position: absolute; top: 16px; right: 20px; font-size: 28px; color: var(--text-dim); cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border: none; background: none; }
    .premium-gift { font-size: 72px; margin-bottom: 16px; }
    .premium-title { font-size: 28px; font-weight: 700; margin-bottom: 28px; }
    .premium-features { width: 100%; max-width: 340px; margin-bottom: 32px; }
    .premium-feature { display: flex; align-items: center; gap: 12px; padding: 10px 0; font-size: 16px; font-weight: 500; }
    .premium-feature-icon { font-size: 22px; width: 32px; text-align: center; }
    .premium-plans { width: 100%; max-width: 340px; display: flex; flex-direction: column; gap: 12px; margin-bottom: 20px; }
    .premium-plan { display: flex; align-items: center; justify-content: space-between; padding: 16px 18px; border-radius: 14px; border: 2px solid var(--border); background: var(--surface); cursor: pointer; transition: all 0.2s; gap: 10px; }
    .premium-plan.selected { border-color: var(--premium-red); }
    .premium-plan-info { display: flex; flex-direction: column; flex: 1; }
    .premium-plan-name { font-size: 16px; font-weight: 700; }
    .premium-plan-price { font-size: 13px; color: var(--text-dim); margin-top: 2px; }
    .premium-plan-price .original { text-decoration: line-through; margin-right: 6px; }
    .premium-plan-badge { font-size: 11px; font-weight: 700; padding: 4px 8px; border-radius: 6px; background: var(--premium-red); color: #fff; white-space: nowrap; }
    .premium-plan-radio { width: 24px; height: 24px; border-radius: 50%; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .premium-plan.selected .premium-plan-radio { border-color: var(--premium-red); background: var(--premium-red); }
    .premium-plan.selected .premium-plan-radio::after { content: '\2713'; color: #fff; font-size: 14px; font-weight: 700; }
    .premium-trial-row { display: flex; align-items: center; justify-content: space-between; width: 100%; max-width: 340px; padding: 14px 18px; border-radius: 14px; background: #333; margin-bottom: 24px; }
    .premium-trial-label { font-size: 15px; font-weight: 600; }
    .premium-toggle { width: 50px; height: 28px; border-radius: 14px; background: var(--green); position: relative; cursor: pointer; border: none; flex-shrink: 0; }
    .premium-toggle::after { content: ''; position: absolute; top: 3px; left: 25px; width: 22px; height: 22px; border-radius: 50%; background: #fff; transition: left 0.2s; }
    .premium-toggle.off { background: #555; } .premium-toggle.off::after { left: 3px; }
    .premium-cta { width: 100%; max-width: 340px; padding: 16px; border-radius: 14px; background: var(--premium-red); color: #fff; font-size: 18px; font-weight: 700; border: none; cursor: pointer; text-align: center; font-family: 'DM Sans', sans-serif; }
    .premium-cta:active { opacity: 0.9; transform: scale(0.98); }
    .premium-cta:disabled { opacity: 0.5; }
    .premium-footer-links { display: flex; gap: 16px; margin-top: 16px; }
    .premium-footer-links a { color: var(--text-dim); font-size: 12px; text-decoration: underline; }
    @media (max-height: 700px) { .num-key { width: 60px; height: 60px; font-size: 22px; } .numpad { gap: 8px; } .numpad-row { gap: 12px; } .field { padding: 14px 16px; } .field-value { font-size: 24px; } }
    @media (max-height: 600px) { .num-key { width: 50px; height: 50px; font-size: 20px; } .numpad { gap: 6px; } .numpad-row { gap: 10px; } .ad-slot#adMid { display: none; } .ad-slot#adBottom { display: none; } }
  </style>
</head>
<body>
<div class="app">
  <div class="premium-banner" id="premiumBanner" onclick="showPremium()">
    <span class="premium-banner-icon">üéÅ</span>
    <span class="premium-banner-text">Unlock Premium</span>
  </div>
  <div class="ad-slot" id="adTop">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9202142689270811" data-ad-slot="9385490563" data-ad-format="auto" data-full-width-responsive="true"></ins>
  </div>
  <div class="rate-bar">
    <span class="rate-label">1 SGD =</span>
    <span class="rate-value" id="rateValue">Loading...</span>
    <span class="change-badge" id="changeBadge" style="display:none"></span>
  </div>
  <div class="fields-wrapper">
    <div class="field active-sgd" id="sgdField" onclick="handleFieldTap('sgd')">
      <div class="field-left"><div class="currency-icon sgd">üá∏üá¨</div><span class="currency-label">SGD</span></div>
      <span class="field-value" id="sgdValue">0</span>
    </div>
    <div class="swap-btn" onclick="handleSwap()">‚áÖ</div>
    <div class="field" id="jpyField" onclick="handleFieldTap('jpy')">
      <div class="field-left"><div class="currency-icon jpy">üáØüáµ</div><span class="currency-label">JPY</span></div>
      <span class="field-value dim" id="jpyValue">0</span>
    </div>
  </div>
  <div class="ad-slot" id="adMid">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9202142689270811" data-ad-slot="7754037637" data-ad-format="auto" data-full-width-responsive="true"></ins>
  </div>
  <div class="numpad">
    <div class="numpad-row"><button class="num-key" onclick="handleKey('1')">1</button><button class="num-key" onclick="handleKey('2')">2</button><button class="num-key" onclick="handleKey('3')">3</button></div>
    <div class="numpad-row"><button class="num-key" onclick="handleKey('4')">4</button><button class="num-key" onclick="handleKey('5')">5</button><button class="num-key" onclick="handleKey('6')">6</button></div>
    <div class="numpad-row"><button class="num-key" onclick="handleKey('7')">7</button><button class="num-key" onclick="handleKey('8')">8</button><button class="num-key" onclick="handleKey('9')">9</button></div>
    <div class="numpad-row"><button class="num-key" onclick="handleKey('.')">.</button><button class="num-key" onclick="handleKey('0')">0</button><button class="num-key clear" onclick="handleKey('C')">C</button></div>
  </div>
  <div class="ad-slot" id="adBottom">
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9202142689270811" data-ad-slot="6322011824" data-ad-format="auto" data-full-width-responsive="true"></ins>
  </div>
  <div class="footer">
    <div class="footer-row"><span style="font-size:11px">üîÑ</span><span class="footer-text" id="footerText">Last updated --:--</span></div>
    <div class="footer-premium" id="footerPremium" onclick="showPremium()">Unlock real-time rates with Premium</div>
  </div>
</div>

<div class="premium-overlay hidden" id="premiumOverlay">
  <button class="premium-close" onclick="closePremium()">‚úï</button>
  <div class="premium-gift">üéÅ</div>
  <div class="premium-title">Unlock Premium</div>
  <div class="premium-features">
    <div class="premium-feature"><span class="premium-feature-icon">üí±</span><span>Instant SGD/JPY conversion</span></div>
    <div class="premium-feature"><span class="premium-feature-icon">üì°</span><span>Works offline</span></div>
    <div class="premium-feature"><span class="premium-feature-icon">‚è±Ô∏è</span><span>Auto-updates rates online</span></div>
    <div class="premium-feature"><span class="premium-feature-icon">üö´</span><span>Remove all ads</span></div>
  </div>
  <div class="premium-plans">
    <div class="premium-plan" id="planYearly" onclick="selectPlan('yearly')">
      <div class="premium-plan-info">
        <span class="premium-plan-name">Annual Plan</span>
        <span class="premium-plan-price" id="yearlyPrice"><span class="original">¬•36,400</span>¬•2,500 / year</span>
      </div>
      <span class="premium-plan-badge">SAVE 93%</span>
      <div class="premium-plan-radio"></div>
    </div>
    <div class="premium-plan selected" id="planWeekly" onclick="selectPlan('weekly')">
      <div class="premium-plan-info">
        <span class="premium-plan-name">3-Day Free Trial</span>
        <span class="premium-plan-price" id="weeklyPrice">Then ¬•700 / week</span>
      </div>
      <div class="premium-plan-radio"></div>
    </div>
  </div>
  <div class="premium-trial-row">
    <span class="premium-trial-label">Enable free trial</span>
    <button class="premium-toggle" id="trialToggle" onclick="toggleTrial()"></button>
  </div>
  <button class="premium-cta" id="premiumCta" onclick="handlePurchase()">Start Free Trial ‚ùØ</button>
  <div class="premium-footer-links">
    <a href="#" onclick="handleRestore();return false;">Restore purchase</a>
    <a href="/privacy-policy.html">Terms & Privacy Policy</a>
  </div>
</div>

<div class="seo-content">
  <h1>Singapore Dollar to Japanese Yen Converter - SGD to JPY Calculator</h1>
  <p>Convert Singapore Dollar to Japanese Yen instantly. Free SGD to JPY calculator with live exchange rates.</p>
</div>

<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebApplication","name":"Singapore Dollar to Japanese Yen Converter","description":"Convert Singapore Dollar to Japanese Yen instantly with live exchange rates.","applicationCategory":"FinanceApplication","operatingSystem":"Any","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}
</script>

<script>
let amount='0',direction='sgd',rate=0,prevRate=0,change24h=0,lastUpdated=null;
const sgdField=document.getElementById('sgdField'),jpyField=document.getElementById('jpyField'),
sgdValue=document.getElementById('sgdValue'),jpyValue=document.getElementById('jpyValue'),
rateValueEl=document.getElementById('rateValue'),changeBadge=document.getElementById('changeBadge'),
footerText=document.getElementById('footerText');

async function fetchRate(){
  var apis=[
    {url:'https://api.exchangerate-api.com/v4/latest/SGD',parse:function(j){return j.rates.JPY;}},
    {url:'https://open.er-api.com/v6/latest/SGD',parse:function(j){return j.rates.JPY;}}
  ];
  for(var i=0;i<apis.length;i++){
    try{
      var r=await fetch(apis[i].url);if(!r.ok)continue;
      var j=await r.json();var newRate=apis[i].parse(j);
      if(!newRate||isNaN(newRate))continue;
      if(rate)prevRate=rate;rate=newRate;lastUpdated=new Date();
      var c=localStorage.getItem('sgd_jpy');
      if(c){var d=JSON.parse(c);if(Date.now()-d.ts>86400000){change24h=Math.round((rate-d.rate)/d.rate*10000)/100;}}
      localStorage.setItem('sgd_jpy',JSON.stringify({rate,ts:Date.now()}));
      updateUI();return;
    }catch(e){continue;}
  }
  var c=localStorage.getItem('sgd_jpy');
  if(c){var d=JSON.parse(c);rate=d.rate;lastUpdated=new Date(d.ts);updateUI();}
  else{rate=113.0;lastUpdated=new Date();updateUI();}
}
function updateUI(){
  const dir=rate>prevRate?'up':rate<prevRate?'down':'';
  rateValueEl.textContent=(dir==='up'?'‚ñ≤ ':dir==='down'?'‚ñº ':'')+'¬•'+rate.toFixed(2);
  rateValueEl.className='rate-value '+dir;
  if(change24h){changeBadge.style.display='inline';changeBadge.textContent=(change24h>0?'+':'')+change24h+'%';
  changeBadge.className='change-badge '+(change24h>0?'positive':'negative');}
  if(lastUpdated)footerText.textContent='Last updated '+lastUpdated.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false});
  updateConversion();
}
function updateConversion(){
  const n=parseFloat(amount)||0;if(!rate)return;
  if(direction==='sgd'){
    sgdValue.textContent=amount;sgdValue.className='field-value'+(amount.length>12?' small':'');
    const r=n*rate;const d=r.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
    jpyValue.textContent=d;jpyValue.className='field-value dim'+(d.length>12?' small':'');
  }else{
    jpyValue.textContent=amount;jpyValue.className='field-value'+(amount.length>12?' small':'');
    const r=n/rate;const d=r.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
    sgdValue.textContent=d;sgdValue.className='field-value dim'+(d.length>12?' small':'');
  }
}
function handleFieldTap(f){if(direction===f)return;direction=f;amount='0';
  sgdField.className=f==='sgd'?'field active-sgd':'field';
  jpyField.className=f==='jpy'?'field active-jpy':'field';updateConversion();}
function handleKey(k){if(k==='C'){amount='0';updateConversion();return;}
  if(k==='.'&&amount.includes('.'))return;
  if(amount==='0'&&k!=='.')amount=k;else if(amount.length<15)amount+=k;updateConversion();}
function handleSwap(){direction=direction==='sgd'?'jpy':'sgd';amount='0';
  sgdField.className=direction==='sgd'?'field active-sgd':'field';
  jpyField.className=direction==='jpy'?'field active-jpy':'field';updateConversion();}
document.addEventListener('keydown',e=>{
  if(e.key>='0'&&e.key<='9')handleKey(e.key);
  else if(e.key==='.')handleKey('.');
  else if(e.key==='Backspace'){amount=amount.length<=1?'0':amount.slice(0,-1);updateConversion();}
  else if(e.key==='c'||e.key==='C')handleKey('C');
  else if(e.key==='Tab'){e.preventDefault();handleSwap();}
});
fetchRate();setInterval(fetchRate,300000);
if('serviceWorker'in navigator)navigator.serviceWorker.register('/sw.js').catch(()=>{});

/* ========== PLAY BILLING ========== */
const SKU_WEEKLY='sgd_jpy_premium_weekly',SKU_YEARLY='sgd_jpy_premium_yearly';
let isPremium=false,selectedPlan='weekly',trialEnabled=true,dgService=null;

async function initBilling(){
  if(!('getDigitalGoodsService'in window)){
    isPremium=localStorage.getItem('sgd_jpy_premium')==='1';applyPremiumState();return;}
  try{dgService=await window.getDigitalGoodsService('https://play.google.com/billing');
    await checkExistingPurchases();await loadSkuDetails();
  }catch(e){isPremium=localStorage.getItem('sgd_jpy_premium')==='1';}
  applyPremiumState();
}

async function checkExistingPurchases(){
  if(!dgService)return;
  try{var purchases=await dgService.listPurchases();
    for(var i=0;i<purchases.length;i++){
      if(purchases[i].itemId===SKU_WEEKLY||purchases[i].itemId===SKU_YEARLY){
        isPremium=true;localStorage.setItem('sgd_jpy_premium','1');return;}}
    isPremium=false;localStorage.removeItem('sgd_jpy_premium');
  }catch(e){}
}

async function loadSkuDetails(){
  if(!dgService)return;
  try{var details=await dgService.getDetails([SKU_WEEKLY,SKU_YEARLY]);
    for(var i=0;i<details.length;i++){
      var item=details[i];
      var price=new Intl.NumberFormat(navigator.language,{style:'currency',currency:item.price.currency}).format(item.price.value);
      if(item.itemId===SKU_WEEKLY){document.getElementById('weeklyPrice').textContent='Then '+price+' / week';}
      else if(item.itemId===SKU_YEARLY){document.getElementById('yearlyPrice').innerHTML='<span class="original">¬•36,400</span>'+price+' / year';}
    }
  }catch(e){}
}

async function handlePurchase(){
  var sku=selectedPlan==='yearly'?SKU_YEARLY:SKU_WEEKLY;
  var cta=document.getElementById('premiumCta');
  if(dgService){
    cta.disabled=true;cta.textContent='Processing...';
    try{
      var pm=[{supportedMethods:'https://play.google.com/billing',data:{sku:sku}}];
      var pd={total:{label:'Total',amount:{currency:'JPY',value:'0'}}};
      var req=new PaymentRequest(pm,pd);var resp=await req.show();
      var token=resp.details.purchaseToken;
      var ok=await verifyPurchaseOnBackend(token,sku);
      if(ok){isPremium=true;localStorage.setItem('sgd_jpy_premium','1');await resp.complete('success');applyPremiumState();closePremium();}
      else{await resp.complete('fail');alert('Purchase verification failed. Please try again.');}
    }catch(e){}
    cta.disabled=false;updateCtaText();return;}
  isPremium=true;localStorage.setItem('sgd_jpy_premium','1');applyPremiumState();closePremium();
}

async function verifyPurchaseOnBackend(purchaseToken,sku){
  try{var res=await fetch('/api/verify-purchase',{method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({purchaseToken:purchaseToken,sku:sku})});
    var data=await res.json();return data.valid===true;
  }catch(e){return false;}
}

async function handleRestore(){
  if(dgService){await checkExistingPurchases();applyPremiumState();
    if(isPremium){closePremium();alert('Premium restored!');}
    else{alert('No active subscription found.');}return;}
  if(localStorage.getItem('sgd_jpy_premium')==='1'){isPremium=true;applyPremiumState();closePremium();alert('Premium restored!');}
  else{alert('No active subscription found.');}
}

function applyPremiumState(){
  var b=document.getElementById('premiumBanner'),f=document.getElementById('footerPremium');
  if(isPremium){b.classList.add('hidden');f.classList.add('hidden');
    var t=document.getElementById('adTop'),m=document.getElementById('adMid'),bt=document.getElementById('adBottom');
    if(t)t.style.display='none';if(m)m.style.display='none';if(bt)bt.style.display='none';
  }else{b.classList.remove('hidden');f.classList.remove('hidden');}
}
function showPremium(){document.getElementById('premiumOverlay').classList.remove('hidden');}
function closePremium(){document.getElementById('premiumOverlay').classList.add('hidden');}
function selectPlan(plan){selectedPlan=plan;
  document.getElementById('planYearly').className='premium-plan'+(plan==='yearly'?' selected':'');
  document.getElementById('planWeekly').className='premium-plan'+(plan==='weekly'?' selected':'');updateCtaText();}
function toggleTrial(){trialEnabled=!trialEnabled;
  document.getElementById('trialToggle').className='premium-toggle'+(trialEnabled?'':' off');updateCtaText();}
function updateCtaText(){var cta=document.getElementById('premiumCta');
  if(trialEnabled&&selectedPlan==='weekly')cta.textContent='Start Free Trial \u276F';
  else if(selectedPlan==='yearly')cta.textContent='Subscribe \u2014 \u00A52,500/year \u276F';
  else cta.textContent='Subscribe \u2014 \u00A5700/week \u276F';}

initBilling();updateCtaText();

if(!window.__ADS_ENABLED__){var t=document.getElementById('adTop'),m=document.getElementById('adMid'),b=document.getElementById('adBottom');
  if(t)t.style.display='none';if(m)m.style.display='none';if(b)b.style.display='none';}
</script>
</body>
</html>
